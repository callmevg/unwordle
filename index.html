<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unwordle - Wordle Solver</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="assets/logo_32.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/logo_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/logo_32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/logo_192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/logo_512.png">
    <link rel="apple-touch-icon" href="assets/logo_192.png">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap">
    <style>
        :root {
            --bg-color: #f4f4f4;
            --text-color: #111;
            --surface-color: #fff;
            --border-color: #111;
            --accent-color: #FF7A00;
            --secondary-accent: #FF7A00;
            --cell-border: #222;
            --hover-color: #f0f0f0;
            --topbar-bg: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] {
            --bg-color: #111;
            --text-color: #fff;
            --surface-color: #222;
            --border-color: #444;
            --accent-color: #FF7A00;
            --secondary-accent: #FF7A00;
            --cell-border: #444;
            --hover-color: #333;
            --topbar-bg: rgba(17, 17, 17, 0.9);
        }

        body {
            font-family: 'Space Mono', monospace;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 3rem;
            background-color: var(--topbar-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            height: 60px;
            box-sizing: border-box;
        }

        .topbar-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--text-color);
            color: var(--text-color);
            padding: 8px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }

        .theme-toggle:hover {
            background: var(--text-color);
        }

        .theme-toggle:hover svg {
            stroke: var(--bg-color);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            stroke: var(--text-color);
            transition: stroke 0.2s ease;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            display: block;
        }

        [data-theme="dark"] .theme-toggle .moon-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .sun-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .moon-icon {
            display: block;
        }

        .app-title {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin: 0;
            color: var(--text-color);
            cursor: pointer;
        }

        .instructions-btn {
            background: #111;
            color: white;
            border: 1px solid #111;
            padding: 8px 16px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0;
            height: 40px;
        }

        .instructions-btn:hover {
            background: #333;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .game-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .results-section {
            width: 100%;
            margin-top: 2rem;
        }

        .instructions-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface-color);
            padding: 2rem;
            border: 2px solid var(--border-color);
            max-width: 500px;
            width: 90%;
            z-index: 1000;
            color: var(--text-color);
            /* margin: 12px; */
        }

        .dialog-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .dialog-close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            gap: 8px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .cell {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            border: 2px solid var(--cell-border);
            border-radius: 0;
            cursor: pointer;
            outline: none;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--surface-color);
            color: var(--text-color);
            transition: all 0.2s ease;
        }
        
        .cell:hover {
            background-color: var(--hover-color);
        }
        
        .cell.green {
            background-color: #6aaa64;
            border-color: #6aaa64;
            color: white;
        }
        
        .cell.yellow {
            background-color: #c9b458;
            border-color: #c9b458;
            color: white;
        }
        
        .cell.gray {
            background-color: #787c7e;
            border-color: #787c7e;
            color: white;
        }

        .buttons {
            display: flex;
            justify-content: left;
            margin-top: 20px;
            gap: 10px;
        }
        
        button {
            margin: 0 10px;
            padding: 12px 24px;
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            cursor: pointer;
            background-color: #111;
            color: white;
            border: none;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .buttons button {
            margin: 0px;
        }
        
        button:hover {
            background-color: #333;
        }
        
        .instructions {
            margin: 30px 0;
            font-size: 14px;
            color: var(--text-color);
            line-height: 1.8;
            text-align: left;
            border-left: 2px solid #111;
            padding-left: 20px;
        }
        
        #results {
            /* margin-top: 40px; */
            text-align: left;
            padding: 20px;
            background-color: var(--surface-color);
            border: 2px solid var(--border-color);
            color: var(--text-color);
        }

        #showMoreBtn {
            margin: 15px 0 0;
            font-size: 12px;
            padding: 8px 16px;
        }
        
        .word-chip {
            background-color: var(--hover-color);
            padding: 8px 16px;
            margin-right: 8px;
            margin-bottom: 8px;
            display: inline-block;
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
            user-select: none;
        }

        .word-chip:hover {
            background-color: var(--border-color);
            color: #f0f0f0;
        }
        
        #message {
            color: #ff3333;
            font-weight: bold;
            min-height: 20px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        @media (max-width: 500px) {
            .grid {
                grid-template-columns: repeat(5, 50px);
            }
            
            .cell {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .instructions-dialog {
                /* padding: 1rem; */
                width: 80%;
            }
            /* body {
                padding: 10px;
            } */
        }

        @media (max-width: 900px) {
            .main-content {
                padding: 1rem;
            }
        }

        #solveBtn {
            background-color: #FF7a00;
            border: none;
            /* color: black; */
        }
        
        #solveBtn:hover {
            background-color: #ff9433;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .footer a {
            color: inherit;
            text-decoration: none;
            border-bottom: 1px solid #666;
        }

        .footer a:hover {
            color: #333;
            border-color: #333;
        }
    </style>
</head>
<body>
    <div class="topbar">
        <h1 class="app-title" onclick="window.location.reload()">Unwordle</h1>
        <div class="topbar-buttons">
            <button class="instructions-btn" onclick="toggleInstructions()">Instructions</button>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="bevel">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="square" stroke-linejoin="bevel">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="game-section">
            <div id="wordleGrid" class="grid"></div>
            <div class="buttons">
                <button id="solveBtn">Solve</button>
                <button id="resetBtn">Reset</button>
            </div>
            <p id="message"></p>
        </div>

        <div class="results-section">
            <div id="results" style="display: none;">
                <h2>Suggestions</h2>
                <p>count: <span id="wordCount">0</span></p>
                <div id="suggestions"></div>
                <button id="showMoreBtn" style="display: none;">Show More</button>
            </div>
        </div>
    </div>

    <div class="footer">
        Made with ❤️ by <a href="https://linkedin.com/in/vaigu" target="_blank">Vaibhav</a> and AI.
    </div>

    <div class="dialog-backdrop" id="dialogBackdrop"></div>
    <div class="instructions-dialog" id="instructionsDialog">
        <button class="dialog-close" onclick="toggleInstructions()">×</button>
        <h2>How to Use</h2>
        <div class="instructions">
            <p>1. Type your Wordle guesses in each row</p>
            <p>2. Click on each letter to change its color based on Wordle feedback:</p>
            <p>   🟩 (correct spot) • 🟨 (wrong spot) • ⬛ (not in word)</p>
            <p>3. Click "Solve" to get word suggestions</p>
        </div>
    </div>

    <script>
        const INITIAL_DISPLAY_COUNT = 10;
        let currentDisplayCount = INITIAL_DISPLAY_COUNT;
        let currentFilteredWords = [];

        // Constants for color feedback
        const CORRECT = 'green';
        const PRESENT = 'yellow';
        const ABSENT = 'gray';
        
        // Best starting words based on letter frequency
        const START_WORDS = [
            "STARE", "CRANE", "SLATE", "ARISE", "RAISE", 
            "AUDIO", "ADIEU", "TRACE", "ROAST", "OUIJA"
        ];
        
        // Global cache for word list
        let wordListCache = null;
        
        // DOM elements
        const wordleGrid = document.getElementById('wordleGrid');
        const solveBtn = document.getElementById('solveBtn');
        const resetBtn = document.getElementById('resetBtn');
        const message = document.getElementById('message');
        const results = document.getElementById('results');
        const wordCount = document.getElementById('wordCount');
        const suggestions = document.getElementById('suggestions');
        
        // Create the grid (6 rows, 5 columns)
        function createGrid() {
            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.contentEditable = true;
                    
                    // Handle input (only allow single letter)
                    cell.addEventListener('input', (e) => {
                        const text = e.target.innerText.toUpperCase();
                        // Only allow alphabets
                        if (text && !/^[A-Z]$/.test(text)) {
                            e.target.innerText = '';
                            return;
                        }
                        if (text.length > 0) {
                            e.target.innerText = text[text.length - 1];
                        }
                        if (text) {
                            // Move to next cell
                            const nextCell = document.querySelector(`[data-row="${i}"][data-col="${j + 1}"]`);
                            if (nextCell) nextCell.focus();
                        }
                    });
                    
                    // Handle color cycling with prevention of text selection
                    cell.addEventListener('click', (e) => {
                        if (e.target.innerText.trim() === '') return;
                        
                        // Prevent text selection
                        e.preventDefault();
                        window.getSelection().removeAllRanges();
                        
                        if (!cell.classList.contains('green') && 
                            !cell.classList.contains('yellow') && 
                            !cell.classList.contains('gray')) {
                            cell.classList.add('green');
                        } else if (cell.classList.contains('green')) {
                            cell.classList.remove('green');
                            cell.classList.add('yellow');
                        } else if (cell.classList.contains('yellow')) {
                            cell.classList.remove('yellow');
                            cell.classList.add('gray');
                        } else {
                            cell.classList.remove('gray');
                        }
                    });
                    
                    // Handle keyboard navigation
                    cell.addEventListener('keydown', (e) => {
                        let nextRow = i, nextCol = j;
                        
                        switch (e.key) {
                            case 'ArrowRight': nextCol++; break;
                            case 'ArrowLeft': nextCol--; break;
                            case 'ArrowUp': nextRow--; break;
                            case 'ArrowDown': nextRow++; break;
                            case 'Enter':
                                // Prevent default behavior which clears the cell
                                e.preventDefault();
                                
                                // Optional: Move to next row, first column
                                if (j === 4) { // If at last column
                                    const nextRowCell = document.querySelector(`[data-row="${i+1}"][data-col="0"]`);
                                    if (nextRowCell) {
                                        nextRowCell.focus();
                                    }
                                }
                                return;
                            case 'Backspace':
                                if (!e.target.textContent || e.target.textContent === '') {
                                    nextCol--;
                                    const prevCell = document.querySelector(`[data-row="${nextRow}"][data-col="${nextCol}"]`);
                                    if (prevCell) {
                                        prevCell.textContent = '';
                                        prevCell.focus();
                                    }
                                } else {
                                    e.target.textContent = '';
                                }
                                e.preventDefault();
                                return;
                        }
                        
                        // Handle navigation for arrow keys
                        if (e.key.startsWith('Arrow')) {
                            const nextCell = document.querySelector(`[data-row="${nextRow}"][data-col="${nextCol}"]`);
                            if (nextCell) {
                                nextCell.focus();
                                e.preventDefault();
                            }
                        }
                    });
                    
                    wordleGrid.appendChild(cell);
                }
            }
        }
        
        // Load words from the JSON file
        async function loadWordList() {
            if (wordListCache) return wordListCache;
            
            try {
                console.log("Loading words from words.json...");
                const response = await fetch('words.json');
                
                if (!response.ok) {
                    throw new Error(`Failed to load words.json: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log("Successfully loaded words.json");
                
                // Extract words from different possible JSON formats
                let words = [];
                if (Array.isArray(data)) {
                    words = data;
                    console.log("Loaded words from array format");
                } else if (typeof data === 'object') {
                    words = Object.keys(data);
                    console.log("Loaded words from object keys");
                } else {
                    throw new Error(`Unexpected data format in words.json: ${typeof data}`);
                }
                
                // Filter to ensure all words are 5 letters
                const filteredWords = words.filter(word => word && word.length === 5);
                console.log(`Found ${filteredWords.length} valid 5-letter words out of ${words.length} total`);
                
                if (filteredWords.length === 0) {
                    throw new Error("No valid 5-letter words found in words.json");
                }
                
                // Convert to uppercase
                wordListCache = filteredWords.map(word => word.toUpperCase());
                console.log(`Successfully loaded ${wordListCache.length} words`);
                
                return wordListCache;
            } catch (error) {
                console.error('Error loading words.json:', error);
                message.textContent = `Error: ${error.message}.`;
                throw error; // Re-throw to halt execution instead of falling back
            }
        }
        
        // Get guesses from the grid
        function getGuesses() {
            const guesses = [];
            
            // Check each row
            for (let i = 0; i < 6; i++) {
                let rowWord = '';
                const rowFeedback = [];
                let hasLetter = false;
                
                // Check each cell in the row
                for (let j = 0; j < 5; j++) {
                    const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                    const letter = cell.innerText.trim().toUpperCase();
                    
                    if (letter) {
                        hasLetter = true;
                        rowWord += letter;
                        
                        // Get color feedback
                        if (cell.classList.contains('green')) {
                            rowFeedback.push(CORRECT);
                        } else if (cell.classList.contains('yellow')) {
                            rowFeedback.push(PRESENT);
                        } else if (cell.classList.contains('gray')) {
                            rowFeedback.push(ABSENT);
                        } else {
                            rowFeedback.push('');
                        }
                    } else {
                        rowWord += ' ';
                        rowFeedback.push('');
                    }
                }
                
                // Only add rows with letters
                if (hasLetter) {
                    guesses.push({
                        row: i,
                        word: rowWord,
                        feedback: rowFeedback
                    });
                }
            }
            
            return guesses;
        }
        
        // Check if all letters have colors
        function validateGuesses(guesses) {
            for (const guess of guesses) {
                // Check if any row has incomplete words
                if (guess.word.includes(' ')) {
                    return {
                        valid: false,
                        message: `Row ${guess.row + 1} has incomplete letters. Fill all 5 letters.`
                    };
                }
                
                // Check if any letter is missing color
                if (guess.feedback.includes('')) {
                    return {
                        valid: false,
                        message: `Row ${guess.row + 1} has letters without colors. Click each letter to set its color.`
                    };
                }
            }
            
            return { valid: true };
        }
        
        // Filter words based on guesses
        function filterWordList(wordList, guesses) {
            return wordList.filter(word => {
                return guesses.every(guess => {
                    const guessWord = guess.word.replace(/ /g, '');
                    const feedback = guess.feedback.filter(f => f !== '');
                    
                    // Check each letter position
                    for (let i = 0; i < guessWord.length; i++) {
                        if (feedback[i] === CORRECT && word[i] !== guessWord[i]) {
                            return false; // Green letter doesn't match
                        }
                        
                        if (feedback[i] === PRESENT && word[i] === guessWord[i]) {
                            return false; // Yellow letter can't be in same position
                        }
                    }
                    
                    // Track letter counts for yellow/gray validation
                    const wordLetterCounts = {};
                    for (const letter of word) {
                        wordLetterCounts[letter] = (wordLetterCounts[letter] || 0) + 1;
                    }
                    
                    // Count minimum required letters (green + yellow positions)
                    const requiredLetterCounts = {};
                    for (let i = 0; i < guessWord.length; i++) {
                        if (feedback[i] === CORRECT || feedback[i] === PRESENT) {
                            const letter = guessWord[i];
                            requiredLetterCounts[letter] = (requiredLetterCounts[letter] || 0) + 1;
                        }
                    }
                    
                    // Verify all required letters exist in sufficient quantities
                    for (const letter in requiredLetterCounts) {
                        if ((wordLetterCounts[letter] || 0) < requiredLetterCounts[letter]) {
                            return false; // Not enough of a required letter
                        }
                    }
                    
                    // Check gray letters - each gray letter means either:
                    // 1. The letter isn't in the word at all, or
                    // 2. We've already accounted for all instances of this letter with green/yellow
                    for (let i = 0; i < guessWord.length; i++) {
                        if (feedback[i] === ABSENT) {
                            const letter = guessWord[i];
                            const requiredCount = requiredLetterCounts[letter] || 0;
                            
                            if (requiredCount === 0 && word.includes(letter)) {
                                return false; // Gray letter shouldn't be present
                            } else if ((wordLetterCounts[letter] || 0) > requiredCount) {
                                return false; // Too many instances of this letter
                            }
                        }
                    }
                    
                    return true;
                });
            });
        }
        
        // Get best suggestions based on letter frequency
        function getBestSuggestions(words, count = 10) {
            if (words.length === 0) return [];
            if (words.length <= count) return words;
            
            // Simple scoring based on letter frequency among possibilities
            const letterFreq = {};
            words.forEach(word => {
                [...new Set(word.split(''))].forEach(letter => {
                    letterFreq[letter] = (letterFreq[letter] || 0) + 1;
                });
            });
            
            // Score words by unique letter frequency
            return words
                .map(word => {
                    const uniqueLetters = [...new Set(word.split(''))];
                    const score = uniqueLetters.reduce((sum, letter) => sum + letterFreq[letter], 0);
                    return { word, score };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, count)
                .map(entry => entry.word);
        }
        
        // Handle the solve button click
        async function handleSolve() {
            message.textContent = '';
            results.style.display = 'none';
            
            try {
                const wordList = await loadWordList();
                
                // Only proceed if we have words
                if (!wordList || wordList.length === 0) {
                    message.textContent = 'Error: No words loaded from words.json';
                    return;
                }
                
                const guesses = getGuesses();
                
                // Case A: No input, suggest starting words from the word list
                if (guesses.length === 0) {
                    // Get good starting words from the word list based on letter frequency
                    const startWords = getGoodStartingWords(wordList);
                    
                    results.style.display = 'block';
                    wordCount.textContent = startWords.length;
                    currentFilteredWords = startWords;
                    displayWords(startWords, startWords.length);
                    return;
                }
                
                // Case B: Input without complete color coding
                const validation = validateGuesses(guesses);
                if (!validation.valid) {
                    message.textContent = validation.message;
                    return;
                }
                
                // Case C: Process input with color coding
                const filteredWords = filterWordList(wordList, guesses);
                const bestWords = getBestSuggestions(filteredWords, 20);
                
                currentFilteredWords = filteredWords;
                currentDisplayCount = INITIAL_DISPLAY_COUNT;
                
                results.style.display = 'block';
                wordCount.textContent = filteredWords.length;
                
                if (filteredWords.length === 0) {
                    suggestions.innerHTML = '<span class="word-chip">No matching words found</span>';
                    document.getElementById('showMoreBtn').style.display = 'none';
                } else {
                    displayWords(filteredWords, currentDisplayCount);
                }
            } catch (error) {
                console.error('Error processing results:', error);
                message.textContent = 'Error finding matches. Make sure words.json exists and is valid.';
            }
        }
        
        // Get good starting words from the word list
        function getGoodStartingWords(wordList) {
            // If we have hardcoded good starting words and they exist in our word list, use them
            const knownGoodStarts = ["STARE", "CRANE", "SLATE", "ARISE", "RAISE", "AUDIO", "ADIEU", "TRACE"];
            const validKnownStarts = knownGoodStarts.filter(word => wordList.includes(word));
            
            if (validKnownStarts.length >= 5) {
                return validKnownStarts;
            }
            
            // Otherwise, find words with good letter distribution
            const letterFreq = {};
            const vowels = new Set(['A', 'E', 'I', 'O', 'U']);
            
            // Count letter frequencies
            wordList.forEach(word => {
                const uniqueLetters = [...new Set(word.split(''))];
                uniqueLetters.forEach(letter => {
                    letterFreq[letter] = (letterFreq[letter] || 0) + 1;
                });
            });
            
            // Score words based on unique letters and vowel/consonant balance
            return wordList
                .map(word => {
                    const letters = [...new Set(word.split(''))];
                    const uniqueLetterCount = letters.length;
                    const hasVowels = letters.some(l => vowels.has(l));
                    const vowelCount = letters.filter(l => vowels.has(l)).length;
                    const consonantCount = uniqueLetterCount - vowelCount;
                    
                    // Words with 5 unique letters and a mix of vowels/consonants score highest
                    let score = letters.reduce((sum, letter) => sum + letterFreq[letter], 0);
                    
                    // Prefer words with 2-3 vowels (not too many, not too few)
                    if (vowelCount >= 2 && vowelCount <= 3) score += 1000;
                    
                    // Prefer words with all unique letters
                    if (uniqueLetterCount === 5) score += 2000;
                    
                    return { word, score };
                })
                .sort((a, b) => b.score - a.score)
                .slice(0, 10)
                .map(entry => entry.word);
        }
        
        // Reset the grid
        function handleReset() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.innerText = '';
                cell.classList.remove('green', 'yellow', 'gray');
            });
            message.textContent = '';
            
            // Focus first cell after reset
            const firstCell = document.querySelector('[data-row="0"][data-col="0"]');
            if (firstCell) firstCell.focus();
            
            // Show initial suggestions after reset
            handleSolve();
        }

        function fillWordInGrid(word, keepFocus = true) {
            let emptyRow = -1;
            for (let i = 0; i < 6; i++) {
                const firstCell = document.querySelector(`[data-row="${i}"][data-col="0"]`);
                if (!firstCell.textContent.trim()) {
                    emptyRow = i;
                    break;
                }
            }

            if (emptyRow === -1) {
                message.textContent = 'No empty rows available';
                return;
            }

            word = word.toUpperCase();
            for (let j = 0; j < 5; j++) {
                const cell = document.querySelector(`[data-row="${emptyRow}"][data-col="${j}"]`);
                cell.textContent = word[j];
            }

            // Keep focus on clicked element if keepFocus is true
            if (!keepFocus) {
                document.activeElement.blur();
            }
        }

        // Initialize the app
        function init() {
            createGrid();
            solveBtn.addEventListener('click', handleSolve);
            resetBtn.addEventListener('click', handleReset);
            
            // Initialize theme from localStorage or system preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.setAttribute('data-theme', savedTheme || (prefersDark ? 'dark' : 'light'));
            
            document.getElementById('showMoreBtn').addEventListener('click', () => {
                currentDisplayCount += 10;
                displayWords(currentFilteredWords, currentDisplayCount);
            });
            
            // Pre-load word list and show initial suggestions
            loadWordList().then(() => {
                handleSolve();
                // Set initial focus
                const firstCell = document.querySelector('[data-row="0"][data-col="0"]');
                if (firstCell) firstCell.focus();
            });
            
            document.getElementById('dialogBackdrop').addEventListener('click', toggleInstructions);
        }

        function displayWords(words, count) {
            suggestions.innerHTML = '';
            const displayWords = words.slice(0, count);
            
            displayWords.forEach(word => {
                const chip = document.createElement('span');
                chip.className = 'word-chip';
                chip.textContent = word;
                chip.tabIndex = 0; // Make chips focusable
                chip.addEventListener('click', (e) => {
                    fillWordInGrid(word);
                    e.target.focus(); // Keep focus on the clicked chip
                });
                suggestions.appendChild(chip);
            });
            
            const showMoreBtn = document.getElementById('showMoreBtn');
            showMoreBtn.style.display = words.length > count ? 'block' : 'none';
        }

        function toggleInstructions() {
            const dialog = document.getElementById('instructionsDialog');
            const backdrop = document.getElementById('dialogBackdrop');
            const isVisible = dialog.style.display === 'block';
            
            dialog.style.display = isVisible ? 'none' : 'block';
            backdrop.style.display = isVisible ? 'none' : 'block';
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>